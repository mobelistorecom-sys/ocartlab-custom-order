<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OC Artlab | Order Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            // --- DATA PERSISTENCE (LOCAL STORAGE) ---
            const savedRates = JSON.parse(localStorage.getItem('ocArtlabRates'));
            const savedOrders = JSON.parse(localStorage.getItem('ocArtlabOrders'));

            const [rates, setRates] = useState(savedRates || { 
                halfBody: 17.08, 
                fullBody: 13.66, 
                pet: 10.00, 
                discount: 0 
            });

            const [orders, setOrders] = useState(savedOrders || [
                { id: 1, name: 'New Client', framing: 'halfBody', qty: 1, pets: 0 }
            ]);

            const [lastSaved, setLastSaved] = useState('');
            const fileInputRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('ocArtlabRates', JSON.stringify(rates));
                localStorage.setItem('ocArtlabOrders', JSON.stringify(orders));
                setLastSaved(new Date().toLocaleTimeString());
            }, [rates, orders]);

            // --- CSV IMPORT LOGIC ---
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        const importedOrders = results.data.map((row, index) => ({
                            id: Date.now() + index,
                            name: row.name || 'Unknown Client',
                            framing: row.framing === 'fullBody' ? 'fullBody' : 'halfBody',
                            qty: parseInt(row.qty) || 1,
                            pets: parseInt(row.pets) || 0
                        }));

                        if (window.confirm(`Import ${importedOrders.length} orders? Current draft will be merged.`)) {
                            setOrders([...importedOrders, ...orders]);
                        }
                        // Reset file input
                        e.target.value = null;
                    }
                });
            };

            // --- DASHBOARD LOGIC ---
            const clearDraft = () => {
                if (confirm('Clear all data?')) setOrders([{ id: Date.now(), name: '', framing: 'halfBody', qty: 1, pets: 0 }]);
            };

            const calculateTotal = (o) => {
                const sub = (o.qty * rates[o.framing]) + (o.pets * rates.pet);
                return sub - (sub * (rates.discount / 100));
            };

            const grandTotal = orders.reduce((acc, o) => acc + calculateTotal(o), 0);

            return (
                <div className="max-w-5xl mx-auto p-6 md:p-12 min-h-screen font-sans">
                    <header className="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6 print:hidden">
                        <div>
                            <h1 className="text-4xl font-black tracking-tighter text-indigo-600 italic">OC ARTLAB</h1>
                            <div className="flex items-center gap-2 mt-1">
                                <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                <p className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Auto-saved: {lastSaved}</p>
                            </div>
                        </div>
                        
                        <div className="flex flex-wrap gap-3">
                            <input 
                                type="file" 
                                accept=".csv" 
                                onChange={handleFileUpload} 
                                ref={fileInputRef} 
                                className="hidden" 
                            />
                            <button 
                                onClick={() => fileInputRef.current.click()}
                                className="bg-white border-2 border-indigo-100 text-indigo-600 px-5 py-2.5 rounded-2xl font-bold hover:bg-indigo-50 transition-all text-xs flex items-center gap-2"
                            >
                                ðŸ“¥ Import CSV
                            </button>
                            <button onClick={clearDraft} className="bg-slate-100 text-slate-500 px-5 py-2.5 rounded-2xl font-bold hover:bg-red-50 hover:text-red-500 transition-all text-xs">
                                Reset
                            </button>
                            <button onClick={() => window.print()} className="bg-indigo-600 text-white px-6 py-2.5 rounded-2xl font-bold shadow-lg hover:shadow-indigo-200 transition-all text-xs">
                                Export PDF
                            </button>
                        </div>
                    </header>

                    {/* Rates & Stats */}
                    <div className="grid md:grid-cols-3 gap-6 mb-12 print:hidden">
                        <div className="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm">
                            <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Edit Global Rates</h3>
                            <div className="space-y-3">
                                {['halfBody', 'fullBody', 'pet'].map(key => (
                                    <div key={key} className="flex items-center justify-between bg-slate-50 p-2 rounded-xl">
                                        <span className="text-[10px] font-bold text-slate-500 uppercase">{key}</span>
                                        <input 
                                            type="number" 
                                            value={rates[key]} 
                                            onChange={e => setRates({...rates, [key]: parseFloat(e.target.value) || 0})}
                                            className="w-16 bg-transparent text-right font-black text-indigo-600 outline-none"
                                        />
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-indigo-50 p-6 rounded-[2rem] border border-indigo-100 flex flex-col justify-center">
                            <span className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Global Discount (%)</span>
                            <input 
                                type="number" 
                                value={rates.discount} 
                                onChange={e => setRates({...rates, discount: e.target.value})} 
                                className="bg-transparent text-5xl font-black text-indigo-600 outline-none mt-2"
                            />
                        </div>

                        <div className="bg-indigo-600 p-6 rounded-[2rem] shadow-2xl shadow-indigo-200 text-white flex flex-col justify-center">
                            <span className="text-[10px] font-black text-indigo-200 uppercase tracking-widest">Total Income</span>
                            <p className="text-4xl font-black mt-2">${grandTotal.toFixed(2)}</p>
                        </div>
                    </div>

                    {/* Orders Table */}
                    <div className="bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden">
                        <div className="p-6 border-b border-slate-50 flex justify-between items-center print:hidden">
                            <h2 className="font-black text-slate-700 uppercase text-xs tracking-widest">Invoices ({orders.length})</h2>
                            <button onClick={() => setOrders([{ id: Date.now(), name: '', framing: 'halfBody', qty: 1, pets: 0 }, ...orders])} className="text-indigo-600 font-bold text-xs hover:bg-indigo-50 px-3 py-1 rounded-lg transition-all">+ Add New Row</button>
                        </div>

                        <div className="divide-y divide-slate-50">
                            {orders.map(o => (
                                <div key={o.id} className="p-5 flex flex-wrap md:flex-nowrap items-center gap-4 hover:bg-slate-50/50 transition-all print:border-b print:shadow-none">
                                    <input 
                                        className="flex-1 min-w-[180px] font-bold text-slate-700 outline-none bg-transparent" 
                                        placeholder="Client Name..." 
                                        value={o.name} 
                                        onChange={e => setOrders(orders.map(item => item.id === o.id ? {...item, name: e.target.value} : item))} 
                                    />
                                    
                                    <div className="flex items-center gap-3">
                                        <select 
                                            value={o.framing} 
                                            onChange={e => setOrders(orders.map(item => item.id === o.id ? {...item, framing: e.target.value} : item))}
                                            className="bg-white border border-slate-200 p-2 rounded-xl text-[10px] font-black uppercase outline-none"
                                        >
                                            <option value="halfBody">Half Body</option>
                                            <option value="fullBody">Full Body</option>
                                        </select>
                                        
                                        <div className="flex items-center bg-white border border-slate-200 rounded-xl px-3 py-1.5">
                                            <span className="text-[9px] font-black text-slate-400 mr-2">QTY</span>
                                            <input 
                                                type="number" 
                                                value={o.qty} 
                                                onChange={e => setOrders(orders.map(item => item.id === o.id ? {...item, qty: parseInt(e.target.value) || 0} : item))}
                                                className="w-6 text-center font-black text-indigo-600 outline-none text-xs bg-transparent" 
                                            />
                                        </div>

                                        <div className="flex items-center bg-orange-50 border border-orange-100 rounded-xl px-3 py-1.5">
                                            <span className="text-[9px] font-black text-orange-400 mr-2">PET</span>
                                            <input 
                                                type="number" 
                                                value={o.pets} 
                                                onChange={e => setOrders(orders.map(item => item.id === o.id ? {...item, pets: parseInt(e.target.value) || 0} : item))}
                                                className="w-6 text-center font-black text-orange-600 outline-none text-xs bg-transparent" 
                                            />
                                        </div>
                                    </div>

                                    <div className="text-right min-w-[110px] font-black text-indigo-600 text-xl">
                                        ${calculateTotal(o).toFixed(2)}
                                    </div>
                                    <button onClick={() => setOrders(orders.filter(item => item.id !== o.id))} className="text-slate-200 hover:text-red-400 print:hidden transition-colors px-2">âœ•</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <style>
        @media print {
            body { background: white !important; padding: 0 !important; }
            .print\:hidden { display: none !important; }
            input, select { border: none !important; pointer-events: none !important; background: transparent !important; }
            .max-w-5xl { max-width: 100% !important; padding: 0 !important; }
        }
    </style>
</body>
</html>
